<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <title>Predict</title>

        <style>
            .menu {
                margin-bottom: 15px;
                background: #f7f7f7;
                box-shadow: 0px 2px 2px rgba(0, 0, 0, 0.3);
                padding: 30px;
            }
            .menu {
                width: 340px;
                margin: 50px auto;
                font-size: 15px;
                text-align: center;
            }
            .btn {     
                font-size: 15px;
                font-weight: bold;
                min-height: 30px;
                padding: 8px;
                border-radius: 2px;
                width: 80%;
            }
            .btn:hover {
                background-color: aquamarine;
            }
            .menu div {
                margin: 20px auto;
            }
            #back {
                width: fit-content;
            }
            #prediction {
                font-size: 40px;
                text-transform: uppercase;
                font-weight: bold;
            }
        </style>
        <script>
            const URL = 'http://192.168.15.39:8080/prediction';
            var recordAction = "STOP";

            const queryString = window.location.search;
            const urlParams = new URLSearchParams(queryString);

            var xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = function() {
                    var tmp = document.getElementById("prediction")
                    if (this.readyState == 4 && this.status == 200) {
                        console.log(this.responseText);
                        tmp.innerHTML = this.responseText
                        tmp.style.color = randDarkColor()
                    }
                }

            setInterval(() => {
                if (recordAction === "START") {
                    xhttp.open("GET", URL, true)
                    xhttp.setRequestHeader('Content-Type', 'application/json');
                    xhttp.send(null);
                }
            }, 1000);

            if (urlParams.has("ACTION")) {
                recordAction = urlParams.get("ACTION");
            }

            function onPredict() {
                if (recordAction === "STOP") {
                    window.location.href = "/predict?ACTION=START";
                }
                else if (recordAction == "START") {
                    window.location.href = "/predict?ACTION=STOP";
                }
            }

            function onLoad() {
                if (recordAction === "START") {
                    document.getElementById("record").innerHTML = "Stop predicting";
                    document.getElementById("back").disabled = true;
                }
                else if (recordAction === "STOP") {
                    document.getElementById("record").innerHTML = "Start predicting";
                    document.getElementById("back").disabled = false;
                }
            }

            function randDarkColor() {
                var lum = -0.25;
                var hex = String('#' + Math.random().toString(16).slice(2, 8).toUpperCase()).replace(/[^0-9a-f]/gi, '');
                if (hex.length < 6) {
                    hex = hex[0] + hex[0] + hex[1] + hex[1] + hex[2] + hex[2];
                }
                var rgb = "#",
                    c, i;
                for (i = 0; i < 3; i++) {
                    c = parseInt(hex.substr(i * 2, 2), 16);
                    c = Math.round(Math.min(Math.max(0, c + (c * lum)), 255)).toString(16);
                    rgb += ("00" + c).substr(c.length);
                }
                return rgb;
            }

        </script>
    </head>
    <body onload="onLoad()">
        <div class='menu'>
            <h2>Predict</h2>
            <p>This is a powefull tool. Use it wisely!</p>
            <p>You are:</p>
            <p id="prediction">AWESOME</p>
            <div>
                <button class="btn" id="record" type="button" onclick="onPredict()">Start predicting</button>
            </div>
            <div>
                <button id="back" class="btn type="button" onclick="window.location.href = '/'">Back</button>
            </div>
        </div>
    </body>
</html>